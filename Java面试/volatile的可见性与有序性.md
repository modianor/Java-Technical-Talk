#### volatile的可见性与有序性

##### 并发的三个特征

1. 原子性
2. 可见性
3. 有序性

##### volatile满足哪些特征？

1. 可见性

   ###### 什么叫可见性？

   当多个线程并发执行操作共享变量时，线程A对共享变量进行修改，那么其他线程能够立刻知道共享变量已经被改变（重新共享变量获取修改后的值）。

   ###### 如何实现可见性？

   1. Java代码上添加volatile关键字进行标记
   2. 字节码内容上添加ACC_VOLATILE进行标记
   3. jvm虚拟机（这里特指Hotspot虚拟机）**orderAccess.hpp**源码里面利用汇编lock addl和fence原语实现

   ###### 什么是缓存一致性协议（MESI Modified：修改 Exclusive：独占 Shared：共享 Invalid：失效）

   ​		现代计算机一般存在多处理器多核心，一个处理器对应一个物理槽，多处理器之间通过QPI总线连接。一个处理器包含多个核心，每个核心又包含寄存器、L1 cache和L2  cache，多个核心共享L3 cache。处理器的工作就是读和写，我们知道内存的读写速度已经非常快了，但是比起CPU寄存器的读写速度还是比较慢的。为了解决cpu运算速度和内存访问读写速度的矛盾问题，采用了多级缓存技术L1、L2和L3缓存。一般来说L1 cache区分数据缓存和指令缓存。当程序运行起来，需要将参与运算的数据首先从主存复制到所在核心的缓存，运算完成后再写入回主存。

   ​		假设有有两个线程 线程A和线程B 在不同的核心上并行做计算，这两个线程共享变量v。线程A和线程B在运行前都将共享变量v复制到各自核心的缓存中(L1、L2、L3都有共享变量v的拷贝），准备做计算。这是场景描述。

2. 有序性

   程序执行的顺序按照代码书写的顺序执行。

